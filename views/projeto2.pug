doctype html
html(lang="pt-BR")
  head
    title Monitoramento ClimÃ¡tico
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    link(rel="stylesheet" href="/css/design-system.css")
    link(rel="stylesheet" href="/css/projeto2.css")
    link(rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css")
    script(src="https://cdn.jsdelivr.net/npm/chart.js")
    include ./partials/styles.pug
    script(src="/components/user-settings/settings.js")
  
  body
    .glass-background

    header.glass-navbar
      .container
        a.glass-logo(href="/")
          span Projetos IOT
        .header-center
          .title-container
            h2.page-title Monitoramento ClimÃ¡tico
            p.page-subtitle Dados ambientais e geolocalizaÃ§Ã£o em tempo real
        nav.nav-right
          if user
            button.profile-button(type="button")
              img.profile-photo(src=user.avatarUrl || '/img/default-avatar.png' alt=user.username)
              span.username #{user.username}

    .projeto2-container
      .container
        if error
          .glass-alert.alert-error= error
        if success
          .glass-alert.alert-success= success

        // MÃ©tricas no topo lado a lado
        .metrics-grid
          .glass-card.metric-card
            .metric-header
              span.metric-icon ğŸŒ¡ï¸
              span.metric-label Temperatura
            .metric-value#card-temp --Â°C
          .glass-card.metric-card
            .metric-header
              span.metric-icon ğŸ’¨
              span.metric-label Vento
            .metric-value#card-vento -- m/s
          .glass-card.metric-card
            .metric-header
              span.metric-icon ğŸ’§
              span.metric-label Umidade
            .metric-value#card-umidade --%

        // Mapa e GrÃ¡fico lado a lado
        .map-chart-grid
          .glass-card.map-card
            .card-header
              h3.card-title
                span.icon ğŸ—ºï¸
                span LocalizaÃ§Ã£o
            .card-content
              #map
              #clima-info.climate-info
                span Aguardando dados climÃ¡ticos...

          .glass-card.chart-card
            .card-header
              h3.card-title
                span.icon ğŸ“Š
                span GrÃ¡fico Ambiental
              .chart-controls
                select#eixoY.glass-select
                  option(value="temperatura") Temperatura
                  option(value="umidade") Umidade
                  option(value="vento") Velocidade do Vento
                select#eixoX.glass-select
                  option(value="tempo") Tempo
            .card-content.chart-content-full
              canvas#grafico

        // Dados recentes com tabs
        .glass-card.data-card
          .card-header
            h3.card-title
              span.icon ğŸ“‹
              span Dados Recentes
          .card-content
            .data-tabs
              button.tab-button.active(data-tab="mapa") LocalizaÃ§Ã£o
              button.tab-button(data-tab="temp") Temperatura
              button.tab-button(data-tab="umidade") Umidade
              button.tab-button(data-tab="vento") Vento

            .tab-content#tab-mapa.active
              .data-list
                if registrosmapa && registrosmapa.length
                  each registro in registrosmapa.slice(-5)
                    .data-item
                      .data-field
                        strong Lat: 
                        span #{registro.lat}
                      .data-field
                        strong Long: 
                        span #{registro.long}
                else
                  .empty-state
                    p Nenhum dado de localizaÃ§Ã£o disponÃ­vel

            .tab-content#tab-temp
              .data-list
                if registrostemp && registrostemp.length
                  each registro in registrostemp.slice(-5)
                    .data-item
                      .data-field
                        strong Temperatura: 
                        span #{registro.temperatura}Â°C
                else
                  .empty-state
                    p Nenhum dado de temperatura disponÃ­vel

            .tab-content#tab-umidade
              .data-list
                if registrosumidade && registrosumidade.length
                  each registro in registrosumidade.slice(-5)
                    .data-item
                      .data-field
                        strong Umidade: 
                        span #{registro.umidade}%
                else
                  .empty-state
                    p Nenhum dado de umidade disponÃ­vel

            .tab-content#tab-vento
              .data-list
                if registrosvento && registrosvento.length
                  each registro in registrosvento.slice(-5)
                    .data-item
                      .data-field
                        strong Velocidade: 
                        span #{registro.velocidade} m/s
                else
                  .empty-state
                    p Nenhum dado de vento disponÃ­vel

        .actions-section
          a.glass-button.glass-button-secondary(href="/")
            span.icon ğŸ 
            span Voltar Ã  pÃ¡gina inicial

    script(src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js")
    script(src="/socket.io/socket.io.js")
    script(src="/js/projeto2.js")
    if user
      include ../components/user-settings/settings.pug
