// Uses glassmorphism design system

doctype html
html(lang="pt-BR")
  head
    title Cadastro de Animal
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    link(rel="stylesheet" href="/css/design-system.css")
    link(rel="stylesheet" href="/css/projeto1.css")
    include ./partials/styles.pug
    script(src="/components/user-settings/settings.js")
  body
    // Animated background
    .glass-background
    
    // Glass navigation
    header.glass-navbar
      .container
        a.glass-logo(href="/")
          span Projetos IOT
        nav.nav-right
          if user
            button.profile-button(type="button")
              img.profile-photo(
                src=user.avatarUrl || '/img/default-avatar.png'
                alt=`${user.username}`
              )
              span.username #{user.username}

    // Main content container
    .projeto1-container
      .container
        .content-grid
          // Form column
          .form-section
            .glass-card.form-card
              h4.card-title Cadastro de Animal

              if error
                .alert.glass-alert.alert-error= error
              if success
                .alert.glass-alert.alert-success Animal registrado com sucesso!

              form.glass-form(action="/projeto1/register" method="POST")
                .form-group
                  label.form-label(for="identifier") Identificador do animal
                  input#identifier.glass-input(type="text" name="identifier" placeholder="Ex: A123" required)
                .form-group
                  label.form-label(for="allowed") Permitido
                  select#allowed.glass-select(name="allowed" required)
                    option(value="" disabled selected) Selecione uma op√ß√£o
                    option(value="sim") Sim
                    option(value="nao") N√£o
                button.glass-button.glass-button-primary(type="submit") 
                  span.icon üêÑ
                  span Cadastrar
                
                .form-footer
                  a.glass-link(href="/") Voltar √† p√°gina inicial

            // History button
            a.glass-button.glass-button-secondary.history-button(href="/projeto1/registered" target="_blank") 
              span.icon üìã
              span Hist√≥rico completo dos animais

        // Records list column
        .records-section
          .glass-card.records-card
            h4.records-title Animais Registrados
            .records-list
              if registros.length
                each registro in registros
                  .glass-record-item
                    .record-info
                      .record-field
                        strong.field-label Identificador: 
                        span.field-value #{registro.identifier}
                      .record-field
                        strong.field-label Permitido: 
                        span.field-value #{registro.allowed === 'sim' ? 'Sim' : 'N√£o'}
                      .record-field
                        strong.field-label Peso (kg): 
                        span.field-value #{registro.peso}
                      if registro.dataPesoAtualizado
                        .record-field.record-meta
                          span.meta-text Peso atualizado em: #{new Date(registro.dataPesoAtualizado).toLocaleString("pt-BR")}
                      if registro.registradoPor
                        .record-field.record-meta
                          span.meta-text Registrado por #{registro.registradoPor}
                      if registro.data
                        .record-field.record-meta
                          span.meta-text Data: #{new Date(registro.data).toLocaleString("pt-BR")}
                    
                    form.delete-form(action=`/projeto1/delete/${registro.identifier}` method="POST")
                      button.glass-button.glass-button-danger.delete-button(type="submit") 
                        span.icon üóëÔ∏è
                        span Excluir
              else
                .empty-state
                  p.empty-text Nenhum animal registrado ainda.

    // Incluir o card de configura√ß√µes do usu√°rio
    if user
      include ../components/user-settings/settings.pug
